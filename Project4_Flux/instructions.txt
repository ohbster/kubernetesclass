1) Install Flux controllers (cluster-side)
2) Connect Flux to a Git repo (GitRepository)
3) Tell Flux what folder to apply (Kustomization)
4) Put Splunk manifests in that folder

Minimal “first Splunk deploy” checklist (for students)
A) kubectl get pods -n flux-system (controllers up)
B) flux get sources git -A (repo fetched successfully)
C) flux get kustomizations -A (kustomization applied successfully)
D) kubectl -n splunk get pods (Splunk running)



I’ll include both:
  Flux CLI bootstrap (best experience)
  Pure YAML install (if you don’t want to rely on CLI)

  repo/
  clusters/
    dev/
      flux-system/           # created by bootstrap (Flux controllers + sync)
      splunk/                # your Splunk manifests live here
        kustomization.yaml
        namespace.yaml
        statefulset.yaml
        service.yaml
        ...


Option A (Recommended): Flux CLI bootstrap (fastest)
0) Prereqs (student machine)
  kubectl works against the cluster
  git installed
  flux CLI installed (students install once)

Verify cluster access:
  kubectl cluster-info
  kubectl get nodes

1) Install Flux onto the cluster + connect it to GitHub

This creates:
  Flux controllers in flux-system
  a deploy key / token setup
  sync objects that point to your repo

GitHub example:
flux bootstrap github \
  --owner=<GITHUB_ORG_OR_USER> \
  --repository=<REPO_NAME> \
  --branch=main \
  --path=clusters/dev \
  --personal

Verify: “Bootstrap installs Flux + creates the first reconciliation loop from Git.” 

kubectl -n flux-system get pods
flux check
flux get sources git -A
flux get kustomizations -A

Option B: YAML-only install + GitRepository/Kustomization (no bootstrap)
1) Install Flux controllers (official install manifest)

kubectl apply -f https://github.com/fluxcd/flux2/releases/latest/download/install.yaml

kubectl -n flux-system get pods


Apply 
kubectl apply -f myrepo.yaml

Then
kubectl apply -f kustomization.yaml

Now: Put Splunk manifests in Git (Flux will deploy them)
Inside: clusters/dev/splunk/

1) namespace.yaml
2) kustomization.yaml (kustomize file in your repo folder)


git add .
git commit -m "Add splunk dev manifests"
git push

Flux reconcile (optional “make it happen now” command):
flux reconcile kustomization splunk-dev -n flux-system --with-source

If you use Github, Bitbucket, or ADO
kubectl apply -f splunk_kustomization.yaml

Verify

flux get sources git -A
flux get kustomizations -A
kubectl -n splunk-dev get pods,svc,pvc


Verify in cluster:
kubectl -n splunk get pods,svc,pvc


Flux Goals! Flux mental model)

Flux runs two big loops:
  Source Controller fetches Git → stores an artifact in-cluster
  Kustomize Controller applies manifests → enforces drift correction

So troubleshooting often starts with:

flux get sources git -A
flux get kustomizations -A
kubectl -n flux-system logs deploy/source-controller --tail=200
kubectl -n flux-system logs deploy/kustomize-controller --tail=200
