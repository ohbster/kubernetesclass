
helm repo add gatekeeper https://open-policy-agent.github.io/gatekeeper/charts
helm repo update
kubectl create namespace gatekeeper-system

helm install gatekeeper gatekeeper/gatekeeper \
  --namespace gatekeeper-system \
  --set replicas=2

Verify 

kubectl -n gatekeeper-system get pods
kubectl get crd | grep gatekeeper
kubectl get validatingwebhookconfigurations | grep gatekeeper


kubectl apply -f 00-namespaces.yaml
kubectl get ns --show-labels | grep splunk


kubectl apply -f 10-template-argo-app-env-namespace.yaml
kubectl apply -f 11-constraint-argo-app-env-namespace.yaml

kubectl get constrainttemplates | grep k8sargoappenvironment
kubectl get constraints | grep argo-app-env-namespace-lock

kubectl apply -f 20-template-splunk-service-port-by-env.yaml
kubectl apply -f 21-constraint-splunk-service-port-by-env.yaml


kubectl get constrainttemplates | grep k8sserviceportbyenv
kubectl get constraints | grep splunk-service-port-lock
